#detection
﻿$guestAccount = Get-LocalUser | Where-Object { $_.SID.Value -match '-501$' }

if ($guestAccount -and $guestAccount.Name -eq 'Guest') {
    Write-Output "placeholder..."
    exit 1
} else {
    Write-Output "all g"
    exit 0
}

#remediation
﻿$randomSuffix = -join ((0..9) | Get-Random -Count 16)
$newName = "Guest$randomSuffix"

$guestAccount = Get-LocalUser | Where-Object { $_.SID.Value -match '-501$' }

if ($guestAccount -and $guestAccount.Name -eq 'Guest') {

    if (-not $guestAccount.Enabled) {
        Enable-LocalUser -Name "Guest"
    }

    Rename-LocalUser -Name "Guest" -NewName $newName
    Disable-LocalUser -Name $newName
}
else {
    Write-Output "placeholder..."
}
